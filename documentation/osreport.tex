\documentclass[12pt, a4paper]{report}
\usepackage{personalstyle}

\setlength{\parskip}{1em}
\setlength{\parindent}{0em}

\begin{document}
    \begin{titlepage}
        \centering
        \Huge{Eggshell}\\
        \Large{an Operating Systems project}\\
        \normalsize{CPS1012}\\[10pt]
        \Large{Andre' Jenkins}\\
        \small{76999M}
    \end{titlepage}

    \lstset{
        frame       = single,
        numbers     = left,
        showspaces  = false,
        showstringspaces    = false,
        captionpos  = t,
        caption     = \lstname
    }

    \tableofcontents

    \clearpage

    \chapter{Structure of the code}
        The code was structured into different directories, so that they may
        be organised according to what they are supposed to achieve.
        \section{Main files}
            The files here are ones which are used in the front layer of the
            eggshell. Here you may find a main C file that uses the eggshell
            functions, the main eggshell \texttt{.c / .h} files which either
            call multiple other functions, or are simple enough to be on the
            front layer, and other files such as the Makefile, any scripts,
            testfiles, and other miscellaneous files.

            \begin{description}
                \item[\textbf{main.c} --- ]
                    The main \texttt{C} file that the executable is retrieved
                    from. Uses libraries such as \texttt{eggshell} and 
                    \texttt{linenoise}.
                \item[\textbf{eggshell.c/h} ---]
                    The \texttt{eggshell library} used by the main file in order
                    to start the eggshell and utilise it. Uses multiple libraries
                    that are all found in the \texttt{src} directory.
                \item[\textbf{Makefile/Makefile-GCC} ---]
                    The Makefile necessary to generate the executable. The current
                    default Makefile uses the \texttt{Clang} compiler, for reasons
                    stated in the \texttt{README.md} file. To use the Makefile that
                    utilises the \texttt{GCC} compiler instead, either change the
                    name of the \texttt{Makefile-GCC} file, or run \texttt{switch.sh}
                \item[\textbf{switch.sh} ---]
                    A script that aids in switching compilers for the makefile.
                    This was written for each switching between \texttt{Clang} and
                    \texttt{GCC}, due to the ease of debugging with \texttt{Clang},
                    and the standard nature of the \texttt{GCC} compiler.
                \item[\textbf{README.md} ---]
                    The \texttt{README} file holds the instructions to compiling the
                    program, as well as a quick summary of the program and its utilities.
                \item[\textbf{testinput.txt} ---]
                    A file used to test the capabilities of the eggshell. 
                    Running \texttt{./eggshell test} will immediately launch
                    the eggshell and run this script, to provide a quick 
                    testing method.
                \item[\textbf{LICENSE, .gitignore \& .yml files} ---]
                    Files that are unimportant to the project itself.
                    These were used for \texttt{git} purposes, as the project 
                    was also uploaded as a \texttt{git} repository.
            \end{description}

        \section{Source files}
            The files found here are the bulk of the code making up the 
            eggshell. In here, every single \texttt{eggshell header library}
            is present, all of them with their own specific and complicated purpose.
            These were seperated from the main \texttt{eggshell} file 
            in order to organise the core of the project from the 
            specific elements making up the project itself.

            \begin{description}
                \item[\bf{variables.c/h} ---]
                    Contains all the functions and structs relating to the
                    variables created and stored by the \tx{eggshell}. 
                    For example, all the \bb{shell} variables can be found
                    here.
                \item[\bf{printer.c/h} ---]
                    The main file dealing with the \tx{print} command.
                \item[\bf{proc\_manager.c/h} ---]
                    The file dealing with the execution of external commands.
                \item[\bf{sig\_handler.c/h} ---]
                    Contains the \tx{signal handler} function used in order 
                    to suspend and interrupt processes. Also contains an 
                    additional function in order to reawaken a suspended
                    process.
                \item[\bf{redirection.c/h} ---]
                    The main file dealing with \tx{input/output} redirection.
                \item[\bf{pipe\_manager.c/h} ---]
                    Contains functions dealing with the piping system that the
                    \tx{eggshell} offers. Also contains a special execution function,
                    rather than using the one found in \tx{proc\_manager.c/h}
            \end{description}
        
        \section{Other files}
            There are also other directories that contain files that aren't
            integral to the functionality of the eggshell, but are still related
            somewhat.

            \begin{description}
                \item[\bf{documentation/} ---]
                    Contains the \tx{.tex} file that generated this report,
                    as well as other items related to it. In order to recompile it,
                    you'd most likely need to install \TeX{}live first.
                \item[\bf{ci/} ---]
                    Unrelated to the main project. The Makefile here is used for 
                    Continuous Integration for the \tx{git} repository.
                \item[\bf{add-on/} ---]
                    Contains the \tx{linenoise.c/h} library that was used in the 
                    main file to simulate a terminal's prompt with input.
                \item[\bf{.vscode/} ---]
                    Contains files that helped with debugging/building the project
                    in \tx{Visual Studio Code}.
            \end{description}

    \clearpage

    \chapter{Code documentation}
        \section{\tx{main.c}}
            \subsection{Use of \tx{main.c}}
                This code is mainly used in order to produce an executable
                using the \tx{eggshell.} This is because the eggshell is
                mainly used as a sort of \tx{API,} which interfaces with
                the inner functions that the eggshell offers.

                As a result, the \tx{main} implements some not-so-integral
                elements of the eggshell, such as an introduction/boot-up
                screen, an additional \tx{test} argument feature, and some
                \tx{linenoise} functions such as history \ii{(ability to
                use $\uparrow$ and $\downarrow$ keys to traverse through
                older commands)}. It also uses the function \tx{updatePrompt();}
                which updates the prompt of the eggshell in order to display
                the current directory.

                A thing to note is that the external command \tx{clear} is run by the line:

                \texttt{runLine(\quot clear\quot, \quot\quot);}

                ...which is an external function found in \tx{eggshell.c}.

                \bb{\myul{Note:}} In order to test the first part of the program,
                which loads \tx{testinput.txt} and runs it, you'd need to run
                the eggshell with the \tx{test} parameter: \tx{./eggshell test}

                \clearpage


        \clearpage

        \section{\tx{eggshell.c}}
            \subsection{Use of \tx{eggshell.c}}
                This file serves as the \bb{core} of the eggshell itself.
                Its main method, \tx{execute}, executes the line inputted
                by the user. Almost every other function of the eggshell is
                accessed through this main file automatically, using parsing.

            \subsection{\tx{initEggshell()}}
                All this function does is initialise the eggshell. To initialise,
                all it needs to do is initialise its shell variables, which is 
                does by calling the method \tx{initShellVars()} from
                \tx{variables.c}

            \subsection{\tx{runLine(char *command, char *line)}}
                This function executes the command \tx{command} with the
                arguments found in \tx{line}. An example of this is:

                \tx{command} = \tx{\quot chdir\quot} and \tx{line} = \tx{\quot ../src/\quot}

                Which would execute \tx{chdir} with arguments \tx{../src/}. It does this
                by having a significant if/else-if block that checks which function to execute:

                \begingroup
                \fontsize{10pt}{10pt}\selectfont
                \begin{lstlisting}[breaklines, frame=single, gobble=20, style=C]
                    if(strcmp(command, "print") == 0) printLine(line);
                    else if(strcmp(command, "all") == 0) showShellVars();
                    else if(strcmp(command, "vars") == 0) displayUserVars();
                    else if(strcmp(command, "chdir") == 0) changeDirectory(line); 
                    else if(strcmp(command, "source") == 0) runScript(line);
                    else if(strcmp(command, "fg") == 0) resumeProcessSignal(FOREGROUND);
                    else if(strcmp(command, "bg") == 0) resumeProcessSignal(BACKGROUND);
                    else externalCommand(command, line);
                \end{lstlisting}
                \endgroup

                \clearpage

                The function also initialises the signal handler before running the
                processes, so that it can handle \tx{SIGINT} and \tx{SIGTSTP} signals
                given when the user presses \tx{CTRL-C} and \tx{CTRL-Z} respectively.

                \begingroup
                \fontsize{10pt}{10pt}\selectfont
                \begin{lstlisting}[breaklines, frame=single, gobble=20, style=C]
                    struct sigaction sa;

                    sa.sa_handler = signal_handler;
                    sigemptyset(&sa.sa_mask);
                    sa.sa_flags = SA_RESTART;
                  
                    // If conditions for signal handling.
                    // Also creates 2 signal handlers in memory for the SIGINT and SIGTSTP
                    if(sigaction(SIGINT, &sa, NULL) == -1)
                      printf("Couldn't catch SIGINT - Interrupt Signal\n");
                    if(sigaction(SIGTSTP, &sa, NULL) == -1)
                      printf("Couldn't catch SIGTSTP - Suspension Signal\n");
                \end{lstlisting}
                \endgroup
            
            \subsection{\tx{changeDirectory(char* directory)}}
                This function changes the directory to the directory specified by
                the parameter. This is done using the inbuilt \tx{chdir} function.

                If changing the directory was successful, the \tx{\$CWD} shell
                variable is updated, and the new directory is displayed.

                However, if it was failing, \tx{perror} is used to display the
                error message.
            
            \subsection{\tx{runScript(char *filename)}}
                All this function does, is load a \tx{script} file which can have
                any extension, and execute its commands line by line. It contains
                measures, such as ignoring any line starting with \tx{\#}, or 
                any empty lines. This effectively enables commenting support for 
                scripts using the \tx{\#} symbol.

                It also emulates a prompt, so that the output generated when running 
                the script could be more readable to the user.

                \clearpage
            
            \subsection{\tx{execute()}}
                The 

                

\end{document}